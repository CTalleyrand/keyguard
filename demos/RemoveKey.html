<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Remove Key</title>
    <link href="../src/nimiq-style.css" rel="stylesheet">
    <script src="../node_modules/@nimiq/core-web/web-offline.js"></script>
    <script src="../src/lib/Key.js"></script>
    <script src="../src/lib/KeyStore.js"></script>
    <script src="../node_modules/@nimiq/rpc/dist/rpc.umd.js"></script>
</head>
<body>

<div>
    <button>Remove Key API</button>
    password: 1234567890
</div>

<script>
    (async () => {
        // Because the mocked KeyStore.prototype.get function below is defined in this
        // window's scope, Nimiq also needs to be defined and initialized here
        await Nimiq.WasmHelper.doImportBrowser();
        Nimiq.GenesisConfig.test();
    })();

    document.querySelector('button').addEventListener('click', async () => {
        const keyguard = window.open('../src/request/remove-key/');
        const rpc = new Rpc.PostMessageRpcClient(keyguard, '*');
        await rpc.init();

        const secret = Nimiq.Entropy.generate().serialize();
        const key = new Key(secret, Key.Type.BIP39);
        const passphrase = Nimiq.BufferUtils.fromAscii('1234567890');
        await KeyStore.instance.put(key, passphrase);

        const delRequest = {
            keyId: key.id,
            keyLabel: "Main Login"
        };

        try {
            const result = await rpc.call('request', delRequest);
            document.body.appendChild(document.createTextNode(`Result: Key removed: ${result}; `));
        } catch (e) {
            document.body.appendChild(document.createTextNode(`Error: ${e.message || e}; `));
        }

        keyguard.close();
    });
</script>

</body>
</html>
